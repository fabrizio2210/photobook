---
- hosts: webserver
  become: true
  tasks:
    - name: install web packages
      apt:
        name: "{{ web_packages }}"
        state: present
        update_cache: yes
        cache_valid_time: 3600
      vars:
        web_packages:
        - python3.9
        - python3-venv
        - python3-pip
        - python3-setuptools
        - python3-virtualenv
        - python-setuptools
        - libpcre3
        - libpcre3-dev
    - name: install web packages 2
      pip:
        requirements: /opt/photobook/requirements.txt
        virtualenv: /opt/photobook/venv
        virtualenv_command: /usr/bin/python3.9 -m venv

    - name: install Vue.js packages
      apt:
        name: "{{ node_packages }}"
        state: present
        update_cache: yes
        cache_valid_time: 3600
      vars:
        node_packages:
        - nodejs
        - npm

    ###############
    #Installazione ngnix

    - name: install Nginx
      apt:
        name: "{{ node_packages }}"
        state: present
        update_cache: yes
        cache_valid_time: 3600
      vars:
        node_packages:
        - nginx

    - name: Servizio Nginx attivo
      service: name=nginx state=started enabled=yes

    ###############
    #Installazione redis

    - name: install Redis
      apt:
        name: "{{ node_packages }}"
        state: present
        update_cache: yes
        cache_valid_time: 3600
      vars:
        node_packages:
        - redis

    - name: Servizio Redis attivo
      service: name=redis state=started enabled=yes
